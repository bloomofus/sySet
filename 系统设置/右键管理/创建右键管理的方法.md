全文以创建右键在vscode中打开为示例

参考：https://github.com/bloomofus/rightControlManager

# 方法一：使用 Nautilus 扩展

GNOME 文件管理器 Nautilus 允许您扩展右键菜单，您可以通过安装一个 GNOME 扩展来添加此功能。

#### 步骤 1: 安装 `nautilus-extensions` 和 VSCode

1. 确保系统中已安装 VSCode。可以通过以下命令安装：

   ```
   sudo apt update
   sudo apt install code
   ```

2. 安装 `nautilus-extensions` 包：

   ```
   sudo apt install nautilus-extensions
   ```

#### 步骤 2: 创建右键菜单脚本

1. 创建一个自定义脚本，打开 VSCode：

   - 创建一个目录来存放自定义脚本：

     ```
     mkdir -p ~/.local/share/nautilus/scripts
     ```

   - 在该目录下创建一个脚本文件 `open_in_vscode`，并赋予可执行权限：

     ```
     nano ~/.local/share/nautilus/scripts/open_in_vscode
     ```

   - 将以下内容粘贴到脚本中：

     ```
     #!/bin/bash
     code "$1"
     ```

   - 保存并关闭文件，然后为其赋予执行权限：

     ```
     chmod +x ~/.local/share/nautilus/scripts/open_in_vscode
     ```

#### 步骤 3: 刷新 Nautilus

1. 重新启动 Nautilus 以使脚本生效：

   ```
   nautilus -q
   ```

#### 步骤 4: 使用右键菜单

1. 在 Nautilus 文件管理器中，右键点击一个文件夹或文件，选择 "脚本" 菜单，你将看到 "open_in_vscode" 选项，点击它即可在 VSCode 中打开选中的文件或文件夹。

# 方法2：使用python3-nautilus，右键实现顶级菜单

参考：git@github.com:harry-cpp/code-nautilus.git

## 1️⃣ 安装依赖

在终端执行：

```
sudo apt update
sudo apt install python3-nautilus python3-gi
```

------

## 2️⃣ 创建扩展目录

```
mkdir -p ~/.local/share/nautilus-python/extensions
```

------

## 3️⃣ 编写扩展文件

创建文件：

```
nano ~/.local/share/nautilus-python/extensions/open_in_vscode.py
```

粘贴下面这段完整代码（已同时支持：选中项 + 空白处右键）：

```
# VSCode Nautilus Extension
#
# Place me in ~/.local/share/nautilus-python/extensions/,
# ensure you have python-nautilus package, restart Nautilus, and enjoy :)
#
# This script is released to the public domain.

from gi.repository import Nautilus, GObject
from subprocess import call
import os

# path to vscode
VSCODE = 'code'

# what name do you want to see in the context menu?
VSCODENAME = 'Code'

# always create new window?
NEWWINDOW = False


class VSCodeExtension(GObject.GObject, Nautilus.MenuProvider):

    def launch_vscode(self, menu, files):
        safepaths = ''
        args = ''

        for file in files:
            filepath = file.get_location().get_path()
            safepaths += '"' + filepath + '" '

            # If one of the files we are trying to open is a folder
            # create a new instance of vscode
            if os.path.isdir(filepath) and os.path.exists(filepath):
                args = '--new-window '

        if NEWWINDOW:
            args = '--new-window '

        call(VSCODE + ' ' + args + safepaths + '&', shell=True)

    def get_file_items(self, *args):
        files = args[-1]
        item = Nautilus.MenuItem(
            name='VSCodeOpen',
            label='Open in ' + VSCODENAME,
            tip='Opens the selected files with VSCode'
        )
        item.connect('activate', self.launch_vscode, files)

        return [item]

    def get_background_items(self, *args):
        file_ = args[-1]
        item = Nautilus.MenuItem(
            name='VSCodeOpenBackground',
            label='Open in ' + VSCODENAME,
            tip='Opens the current directory in VSCode'
        )
        item.connect('activate', self.launch_vscode, [file_])

        return [item]
```

> 如果你想菜单显示中文，把上面的
>  `"Open in VS Code"` 改成 `"在 VS Code 中打开"` 就行。

保存并退出（`Ctrl+O` 回车，`Ctrl+X`）。

------

## 4️⃣ 重启 Nautilus

```
nautilus -q
```

然后再打开“文件”（Nautilus）。

------

## 5️⃣ 使用效果

- **右键点击某个文件/文件夹**
   菜单中会直接出现：**Open in VS Code**（顶级菜单项，不在“脚本”子菜单里）
- **在目录空白处右键**
   也会有：**Open in VS Code** → 会以当前文件夹为工作区打开 VS Code。